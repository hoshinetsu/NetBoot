<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow, noimageindex, nosnippet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="hoshinetsu">
    <meta name="description" content="yet another remote pc wakeup tool. coded for Emcheratti (=`œâ¬¥=)">
    <!-- kuba hasioku spasiony w dupe se tego burpa wsadz! -->
    <link rel="stylesheet" href="lib/bootstrap.min.css">
    <link rel="shortcut icon" href="/favicon.ico">
    <title>netboot ver. 1.4 | em4e</title>
    <style>
        /* custom bootstrap theme here 'cause who needs sass */
        @keyframes bodybgcolor {
            0% {
                background-color: #002200;
            }

            33% {
                background-color: #003300;
            }

            66% {
                background-color: #004400;
            }

            100% {
                background-color: #005500;
            }
        }

        body {
            background-color: #005500;
            background-image: url('img/bg-tiles.png');
            background-size: cover;
            animation-name: bodybgcolor;
            animation-duration: 8s;
            animation-iteration-count: infinite;
            animation-direction: alternate-reverse;
        }

        header,
        footer {
            background-color: #111;
            color: #44AA00;
        }

        header,
        .modal-header {
            border-bottom: 2px solid #005500;
        }

        footer {
            border-top: 2px solid #005500;
        }

        main,
        .th-modal {
            border: 2px solid #005500;
            background-color: #111;
        }

        .th-header-top {
            font-family: Georgia, 'Times New Roman', Times, serif;
        }

        .th-header-bot {
            font-family: 'Courier New', Courier, monospace;
            letter-spacing: 2px;
            text-indent: 2px;
        }

        .th-fit {
            width: fit-content;
        }

        .th-form {
            background-color: #222;
            border-radius: 8px;
        }

        .th-ptr {
            cursor: pointer;
        }

        .status-log {
            color: #aaa;
            margin-top: -0.8rem;
            font-size: 0.8rem;
        }

        .status-red {
            color: #CC0000;
            font-size: 1.15rem;
            font-weight: bold;
        }

        .status-green {
            color: #44AA00;
            font-size: 1.15rem;
            font-weight: bold;
        }

        .modal-title {
            font-size: 1rem;
        }
    </style>
</head>

<body data-bs-theme="dark" class="vh-100 d-flex flex-column justify-content-start" onload="init()">
    <header class="d-flex flex-row justify-content-center mb-5 pt-3 pb-1">
        <div>
            <h2 class="th-header-top text-center mb-0">Wake That Chungus</h2>
            <h4 class="th-fit th-header-bot mx-auto">like it's 09:11</h4>
        </div>
    </header>
    <main class="container p-3">
        <div class="row justify-content-center">
            <div class="col-xs-12">
                <legend class="text-center text-danger">For üêÄ only</legend>
                <p class="text-center">Prove you are worthy of the <b>chungus</b>, muhahahah!</p>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-xs-12 col-lg-8 col-xl-6">
                <form action="javascript:parseForm()" method="post" class="th-form p-3">
                    <label for="user">What rat name</label>
                    <input type="text" required id="user" class="form-control" autofocus oninput="storeField()">
                    <label class="mt-2" for="pass">What rat say</label>
                    <div class="input-group">
                        <input type="password" required id="pass" class="form-control" oninput="storeField()">
                        <label class="input-group-text th-ptr">
                            <input class="th-ptr" type="checkbox" id="hide" checked
                                onchange="toggleKey()">&nbsp;Mask</label>
                    </div>
                    <div class="mt-3 text-center">
                        <input type="reset" class="btn btn-outline-danger mx-1" value="Forget me rat" id="clear">
                        <input type="submit" class="btn btn-success mx-1" value="Wake the Chungus" id="wake" disabled>
                    </div>
                </form>
            </div>
        </div>
        <div class="row justify-content-center mt-2">
            <div class="col-xs-12 col-lg-8 col-xl-6">
                <p class="text-left">Last updated: <b class="text-success">24.08.2025</b><br>
                Patch notes: <i>adjusted the app for recent network topology changes, allowed for greater waiting times minding potential windows updates, UI glitch fixes</i></p>
            </div>
        </div>
    </main>
    <div class="modal fade" id="actionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content th-modal">
                <div class="modal-header">
                    <h5 class="modal-title" id="actionModalLabel">Waking up the Chungus</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" id="actionModalClose"
                        disabled></button>
                </div>
                <div class="modal-body">
                    <div class="text-center" id="progress">
                        <p class="my-0 th-statusTitle">Waking up might take all the way from 10 seconds up to about a
                            minute, depending whether the PC is in <b>SLEEP</b> state or completely <b>OFF</b>. Any
                            pending updates to Windows might affect the wait time as well. If the process takes more
                            than 5 minutes, contact your <i>king of the servers</i> <code>:#3</code></p>
                        <img src="img/oia-uia.gif" alt="uiia" width="80%">
                        <p class="my-0" id="status"></p>
                    </div>
                    <p class="text-center my-0" id="result"></p>
                </div>
            </div>
        </div>
    </div>
    <script>
        function getId(id) {
            return document.getElementById(id);
        }

        function getLs(ls) {
            return localStorage.getItem(ls)
        }

        function setLs(k, v) {
            localStorage.setItem(k, v);
        }

        function checkIfFilled(value) {
            return value != null && value.trim().length > 0;
        }

        function toggleButtons(on) {
            if (on) {
                getId("wake").removeAttribute("disabled");
            } else {
                getId("wake").setAttribute("disabled", "da");
            }
        }

        function storeField() {
            let allFilled = true;
            document.querySelectorAll("[required]").forEach(element => {
                if (checkIfFilled(element.value)) {
                    setLs(element.id, element.value);
                } else {
                    allFilled = false;
                }
            });
            toggleButtons(allFilled);
        }

        function restoreSaved() {
            let allFilled = true;
            document.querySelectorAll("[required]").forEach(element => {
                let cache = getLs(element.id);
                if (checkIfFilled(cache)) {
                    element.value = cache;
                } else {
                    allFilled = false;
                }
            });
            toggleButtons(allFilled);
        }

        function toggleKey() {
            let pass = getId("pass");
            if (getId("hide").checked) {
                pass.setAttribute("type", "password");
            } else {
                pass.setAttribute("type", "text");
            }
        }

        /* 
            constant values for communication with backend 
            defining what the request should do
        */
        const REQ_PING = 10;
        const REQ_WAKE = 11;

        function sendRequest(q, recurrence = 0) {
            let user = getId("user").value;
            let pass = getId("pass").value;

            let xhr = new XMLHttpRequest();
            xhr.open("GET", `api/auth.php?user=${user}&pass=${pass}&q=${q}`, true);
            xhr.onreadystatechange = function () {
                if (this.readyState == 4) {
                    if (this.status != 200) {
                        interpretError(q, "");
                        return;
                    }
                    let ans = xhr.responseText;
                    if (ans.includes("<out>")) {
                        interpretResponse(q, ans.slice(ans.indexOf("<out>") + 5, ans.indexOf("</out>")), recurrence);
                    } else if (ans.includes("<err>")) {
                        interpretError(q, ans.slice(ans.indexOf("<err>") + 5, ans.indexOf("</err>")));
                    } else {
                        interpretError(q, "server error");
                    }
                }
            }
            xhr.send();
            switch (q) {
                case REQ_PING: {
                    setStatus("pinging the chungus..");
                    break;
                }
                case REQ_WAKE: {
                    setStatus("waking up the chungus..");
                    break;
                }
                default: break;
            }
        }

        function showProgress() {
            getId("status").textContent = "";
            getId("result").textContent = "";
            getId("progress").removeAttribute("style");
            getId("actionModalClose").setAttribute("disabled", "da");
        }

        function hideProgress() {
            getId("progress").setAttribute("style", "display:none");
            getId("actionModalClose").removeAttribute("disabled");
        }

        function setResult(stat, success) {
            let status = getId("result");
            let happySad = success ? "happy" : "sad";
            /* 
                Happysad mentioned!! RAAAH!
                https://open.spotify.com/track/6LuOCaMHFBfaR1MLKNHhMA?si=89bc342b9c534ade
            */
            hideProgress();
            status.innerHTML = `<img src="img/cat-${happySad}.gif" alt="${happySad} cat" width="80%"><br>`
                + `<span class="status-${success ? "green" : "red"}">` + stat + "</span><br>";
        }

        function setStatus(stat) {
            let status = getId("status");
            status.innerHTML = status.innerHTML + `<span class="status-log">` + stat + "</span><br>";
        }

        function interpretError(q, ans) {
            setResult("error: " + ans, false);
        }

        function interpretResponse(q, ans, recurrence) {
            console.log("Recurrence depth: ", recurrence);
            if (recurrence > 30) {
                interpretError(0, "aborted - too many failed attempts");
                return;
            }
            switch (q) {
                case REQ_PING: {
                    let isUp = Number.parseInt(ans) == 1;
                    setStatus("chungus is " + (isUp ? "UP" : "DOWN"));
                    if (isUp) {
                        setResult("The PC is up on the network. Try&nbsp;parsecing!", true);
                    } else {
                        sendRequest(REQ_WAKE, ++recurrence);
                    }
                    break;
                }
                case REQ_WAKE: {
                    let wolSent = Number.parseInt(ans) == 1;
                    setStatus("Magic Packet has been" + (wolSent ? " " : " NOT ") + "sent.");
                    if (wolSent) {
                        let timeout = 10;
                        setStatus(`Waiting ${timeout} seconds for the PC to come online..`);
                        setTimeout(function () {
                            sendRequest(REQ_PING, recurrence);
                        }, timeout * 1000);
                    } else {
                        interpretError(0, "Send failed. Contact your donkey admin!");
                    }
                    break;
                }
                default: {
                    break;
                }
            }
        }

        /* invoked when the form is sent */
        function parseForm() {
            showProgress();
            var myModal = new bootstrap.Modal(document.getElementById('actionModal'), {
                backdrop: 'static',
                keyboard: false
            });
            myModal.show();
            sendRequest(REQ_PING);
        }

        /* invoked when page finishes loading */
        function init() {
            console.log("finished loading.");
            restoreSaved();
        }
    </script>
    <script src="lib/bootstrap.bundle.min.js"></script>
</body>

</html>
