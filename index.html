<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow, noimageindex, nosnippet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="hoshinetsu">
    <meta name="description" content="amazing remote pc wakeup tool. coded for Emcheratti (=`œâ¬¥=)">
    <!-- kuba hasioku spasiony w dupe se tego burpa wsadz! -->
    <link rel="stylesheet" href="lib/bootstrap.min.css">
    <link rel="shortcut icon" href="/favicon.ico">
    <title>wakey ver. 251020 | em4e</title>
    <style>
        /* custom bootstrap theme here 'cause who needs sass */
        @keyframes bodybgcolor {
            0% {
                background-color: #002200;
            }

            33% {
                background-color: #003300;
            }

            66% {
                background-color: #004400;
            }

            100% {
                background-color: #005500;
            }
        }

        body {
            background-color: #005500;
            background-image: url('img/bg-tiles.png');
            background-size: cover;
            animation-name: bodybgcolor;
            animation-duration: 8s;
            animation-iteration-count: infinite;
            animation-direction: alternate-reverse;
        }

        header,
        footer {
            background-color: #111;
            color: #44AA00;
        }

        header,
        .modal-header {
            border-bottom: 2px solid #005500;
        }

        footer {
            border-top: 2px solid #005500;
        }

        main,
        .th-modal {
            border: 2px solid #005500;
            background-color: #111;
        }

        .th-header-top {
            font-family: Georgia, 'Times New Roman', Times, serif;
        }

        .th-header-bot {
            font-family: 'Courier New', Courier, monospace;
            letter-spacing: 2px;
            text-indent: 2px;
        }

        .th-fit {
            width: fit-content;
        }

        .th-form {
            background-color: #222;
            border-radius: 8px;
        }

        .th-ptr {
            cursor: pointer;
        }

        .status-log {
            color: #aaa;
            margin-top: -0.8rem;
            font-size: 0.8rem;
        }

        .status-red {
            color: #CC0000;
            font-size: 1.15rem;
            font-weight: bold;
        }

        .status-green {
            color: #44AA00;
            font-size: 1.15rem;
            font-weight: bold;
        }

        .modal-title {
            font-size: 1rem;
        }
    </style>
</head>

<body data-bs-theme="dark" class="vh-100 d-flex flex-column justify-content-start" onload="init()">
    <header class="d-flex flex-row justify-content-center mb-5 pt-3 pb-1">
        <div>
            <h2 class="th-header-top text-center mb-0">| Wakey Pisi Wakey |</h2>
              <h4 class="th-fit th-header-bot mx-auto">time for gaeming</h4>
        </div>
    </header>
    <main class="container p-3">
        <div class="row justify-content-center">
            <div class="col-xs-12 fadein">
                <legend class="text-center text-danger">Authorizzation required üêÄ</legend>
                <p class="text-center">I apologize, but I have to make sure its not the <b>kuba</b> guy <br>whom I told
                    that he can shove his <i>hacking tools</i> right up his ass</p>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-xs-12 col-lg-8 col-xl-6">
                <form action="javascript:parseForm()" method="post" class="th-form p-3">
                    <label for="user">Your name (yes the 'cutified' one)</label>
                    <input type="text" required id="user" class="form-control" autofocus oninput="storeField()">
                    <label class="mt-2" for="pass">Password (in meow language)</label>
                    <div class="input-group">
                        <input type="password" required id="pass" class="form-control" oninput="storeField()">
                        <label class="input-group-text th-ptr">
                            <input class="th-ptr" type="checkbox" id="hide" checked
                                onchange="toggleKey()">&nbsp;Hide</label>
                    </div>
                    <div class="mt-3 text-center">
                        <input type="reset" class="btn btn-outline-danger mx-1" value="Clear" id="clear">
                        <input type="submit" class="btn btn-success mx-1" value="Wake that Pisi ayy!" id="wake" disabled>
                    </div>
                </form>
            </div>
        </div>
        <div class="row justify-content-center mt-2">
            <div class="col-xs-12 col-lg-8 col-xl-6">
                <p class="text-left">Last updated on <b class="text-success">20.10.2025</b><br> Patch notes: <i>the app
                        returns with new API and pisi wakeup technologia üëåüèø (might be faster too!)</i></p>
                <p class="text-left">Updated on <b class="text-success">25.09.2025</b><br> Patch notes: <i>fixed
                        404-GeorgeNotFound error &amp; fixed waking up from S5 power state, restored old UI text</i></p>
                <p class="text-left">Updated on <b class="text-success">24.08.2025</b><br> Patch notes: <i>adjusted the
                        app for recent network topology changes, allowed for greater waiting times minding potential
                        windows updates, UI glitch fixes</i></p>
            </div>
        </div>
    </main>
    <div class="modal fade" id="actionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content th-modal">
                <div class="modal-header">
                    <h5 class="modal-title" id="actionModalLabel">Waking up the Pisi</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" id="actionModalClose"
                        disabled></button>
                </div>
                <div class="modal-body">
                    <div class="text-center" id="progress">
                        <p class="my-0 th-statusTitle">Let me cook üòä I won't keep you here for more than 3 minutes. If
                            the process times out without any other errors, Windows updates may be to blame. Wait a
                            little and try again. If the problem persists <s>beat</s> hit up the nig.</p>
                        <img src="img/oia-uia.gif" alt="uiia" width="60%">
                        <p class="my-0" id="status"></p>
                    </div>
                    <p class="text-center my-0" id="result"></p>
                </div>
            </div>
        </div>
    </div>
    <script>
        function getId(id) {
            return document.getElementById(id);
        }

        function getLs(ls) {
            return localStorage.getItem(ls)
        }

        function setLs(k, v) {
            localStorage.setItem(k, v);
        }

        function checkIfFilled(value) {
            return value != null && value.trim().length > 0;
        }

        function toggleButtons(on) {
            if (on) {
                getId("wake").removeAttribute("disabled");
            } else {
                getId("wake").setAttribute("disabled", "da");
            }
        }

        function storeField() {
            let allFilled = true;
            document.querySelectorAll("[required]").forEach(element => {
                if (checkIfFilled(element.value)) {
                    setLs(element.id, element.value);
                } else {
                    allFilled = false;
                }
            });
            toggleButtons(allFilled);
        }

        function restoreSaved() {
            let allFilled = true;
            document.querySelectorAll("[required]").forEach(element => {
                let cache = getLs(element.id);
                if (checkIfFilled(cache)) {
                    element.value = cache;
                } else {
                    allFilled = false;
                }
            });
            toggleButtons(allFilled);
        }

        function toggleKey() {
            let pass = getId("pass");
            if (getId("hide").checked) {
                pass.setAttribute("type", "password");
            } else {
                pass.setAttribute("type", "text");
            }
        }
        /* 
            constant values for communication with backend 
            defining what the request should do
        */
        const REQ_PING = { "id": 10, "desc": "ping" };
        const REQ_WAKE = { "id": 11, "desc": "wake" };
        const REQ_PDON = { "id": 20, "desc": "powerup" };
        let powerUpSent,
            resultShown,
            wakeSent;

        function newSendRequest(type, callStack = 0) {
            if (++callStack > 50) {
                resultError("attempt timed out");
                return;
            }
            let user = getId("user").value;
            let pass = getId("pass").value;
            fetch(`api/v2/wake.php?user=${user}&pass=${pass}&q=${type.id}`)
                .then(response => {
                    if (response) {
                        return response.json();
                    }
                    resultError(`server returned "${response.status}"`);
                })
                .then(data => {
                    // updateLog(`got response: ${JSON.stringify(data)}`);
                    if (data.error) {
                        resultError(`API returned "${data.error}"`);
                        return;
                    }
                    switch (type.id) {
                        case REQ_PING.id: {
                            if (data.isUp) {
                                setResult("The pisi is up on the network, go parsec!");
                                break;
                            }
                            if (wakeSent) {
                                let timeout = 3;
                                updateLog(`waiting ${timeout} seconds for next probe..`);
                                setTimeout(function () {
                                    newSendRequest(REQ_PING, callStack);
                                    updateLog(`checking if pisi is on..`);
                                }, timeout * 1000);
                                break;
                            }
                            if (powerUpSent) {
                                newSendRequest(REQ_WAKE, callStack);
                                updateLog("the pisi is powered, sending wake..");
                                break;
                            }
                            newSendRequest(REQ_PDON, callStack);
                            updateLog("the pisi is down, making sure it's powered..");
                            break;
                        }
                        case REQ_WAKE.id: {
                            if (data.magicSent) {
                                wakeSent = true;
                                let timeout = 10;
                                updateLog(`waiting ${timeout} seconds for wakeup..`);
                                setTimeout(function () {
                                    newSendRequest(REQ_PING, callStack);
                                    updateLog(`checking if pisi is on..`);
                                }, timeout * 1000);
                                break;
                            }
                            resultError("unable to send wake command");
                            break;
                        }
                        case REQ_PDON.id: {
                            powerUpSent = true;
                            $str = ", attempting wakeup..";
                            if (data.poweredUp) {
                                updateLog(`the pisi is powered${$str}`);
                            } else {
                                updateLog(`request to PDU failed${$str}`);
                            }
                            newSendRequest(REQ_WAKE, callStack);
                            break;
                        }
                        default: {
                            resultError("wtf, sent unknown request");
                            break;
                        }
                    }
                })
                .catch(error => {
                    resultError(error);
                });
        }

        function showProgress() {
            powerUpSent = false;
            resultShown = false;
            wakeSent = false;
            getId("status").textContent = "";
            getId("result").textContent = "";
            getId("progress").removeAttribute("style");
            getId("actionModalClose").setAttribute("disabled", "da");
            var myModal = new bootstrap.Modal(document.getElementById('actionModal'), {
                backdrop: 'static',
                keyboard: false
            });
            myModal.show();
        }

        function hideProgress() {
            getId("progress").setAttribute("style", "display:none");
            getId("actionModalClose").removeAttribute("disabled");
        }

        function setResult(stat, success = true) {
            if (resultShown) return;
            resultShown = true;
            let status = getId("result");
            let happySad = success ? "happy" : "sad";
            /* 
                Happysad mentioned!! RAAAH!
                https://open.spotify.com/track/6LuOCaMHFBfaR1MLKNHhMA?si=89bc342b9c534ade
            */
            hideProgress();
            status.innerHTML = `<img src="img/cat-${happySad}.gif" alt="${happySad} cat" width="80%"><br>`
                + `<span class="status-${success ? "green" : "red"}">` + stat + "</span><br>";
        }

        function resultError(ans) {
            setResult("error: " + ans, false);
        }

        function updateLog(stat) {
            let status = getId("status");
            status.innerHTML = status.innerHTML + `<span class="status-log">` + stat + "</span><br>";
        }

        /* invoked when the form is sent */
        function parseForm() {
            showProgress();
            newSendRequest(REQ_PING);
        }

        /* invoked when page finishes loading */
        function init() {
            restoreSaved();
            console.log("finished loading.");
        }
    </script>
    <script src="lib/bootstrap.bundle.min.js"></script>
</body>

</html>